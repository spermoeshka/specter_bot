<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>SPECTER VPN</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #000000;
      --text: #ffffff;
      --text-muted: #888888;
      --card: rgba(18, 18, 18, 0.96);
      --border: rgba(255,255,255,0.1);
      --accent: #00ff88;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    html, body { height:100%; overflow:hidden; touch-action:manipulation; }

    body {
      font-family: 'Rajdhani', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: env(safe-area-inset-top) 1rem env(safe-area-inset-bottom) 1rem;
      -webkit-tap-highlight-color: transparent;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.7) 100%);
      pointer-events: none;
      z-index: 2;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.012) 2px, rgba(255,255,255,0.012) 4px);
      pointer-events: none;
      z-index: 3;
    }

    canvas#bg-canvas { position:fixed; inset:0; width:100%; height:100%; z-index:1; pointer-events:none; }
    canvas#prismLetter { position:fixed; inset:0; width:100%; height:100%; z-index:4; pointer-events:none; }

    .logo-container {
      position: relative;
      z-index: 10;
      margin: 9rem 0 1.5rem;
      user-select: none;
    }

    .logo {
      font-family: 'Rajdhani', sans-serif;
      font-size: clamp(3.2rem, 12vw, 6rem);
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      background: linear-gradient(180deg, #ffffff 0%, #999999 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: block;
      line-height: 1;
    }

    .logo-rule {
      width: 100%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      margin: 1.2rem auto 0;
    }

    .subtitle {
      font-family: 'Space Mono', monospace;
      font-size: clamp(0.6rem, 2.5vw, 0.75rem);
      color: var(--text-muted);
      letter-spacing: 0.3em;
      font-weight: 400;
      z-index: 10;
      text-transform: uppercase;
      margin-top: 0.8rem;
    }

    .container {
      width: 100%;
      max-width: 380px;
      padding: 1.2rem 1rem;
      z-index: 10;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow-y: auto;
    }

    .page { display: none; width: 100%; }
    .page.active { display: block; }

    .user-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.2rem 1.4rem;
      margin-bottom: 1rem;
      backdrop-filter: blur(30px);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.04), 0 20px 60px rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .avatar-wrap { position:relative; flex-shrink:0; }

    .avatar {
      width: 52px; height: 52px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      border: 1px solid rgba(255,255,255,0.15);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem;
    }

    .avatar-ring {
      position: absolute; inset: -4px;
      border-radius: 50%;
      border: 1px solid rgba(0,255,136,0.4);
      animation: ringPulse 3s ease-in-out infinite;
    }

    @keyframes ringPulse {
      0%,100% { opacity:0.4; transform:scale(1); }
      50% { opacity:0.9; transform:scale(1.08); }
    }

    .user-info { flex:1; text-align:left; }
    .user-name { font-size:1.05rem; font-weight:700; letter-spacing:0.05em; margin-bottom:0.4rem; }

    .status {
      display: inline-flex; align-items: center; gap: 0.4rem;
      padding: 0.3rem 0.8rem;
      background: rgba(0,255,136,0.1);
      border: 1px solid rgba(0,255,136,0.3);
      border-radius: 20px;
      color: var(--accent);
      font-size: 0.72rem;
      font-family: 'Space Mono', monospace;
      letter-spacing: 0.1em;
    }
    .status::before {
      content: ''; width:6px; height:6px;
      background: var(--accent); border-radius:50%;
      animation: blink 2s ease-in-out infinite;
    }
    .status.error { background:rgba(255,50,50,0.1); border-color:rgba(255,50,50,0.3); color:#ff5555; }
    .status.error::before { background:#ff5555; }

    @keyframes blink {
      0%,100% { opacity:1; }
      50% { opacity:0.3; }
    }

    .buttons { display:grid; grid-template-columns:1fr 1fr; gap:0.75rem; margin:1rem 0; }

    .btn {
      padding: 1rem;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.9rem; font-weight:700;
      letter-spacing: 0.15em;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      transition: all 0.25s;
      touch-action: manipulation;
      text-transform: uppercase;
      backdrop-filter: blur(20px);
    }
    .btn:hover { border-color:rgba(255,255,255,0.25); background:rgba(35,35,35,0.95); }
    .btn:active { transform:scale(0.97); }
    .btn:disabled { opacity:0.4; cursor:not-allowed; }

    .btn-primary {
      background: linear-gradient(135deg, #ffffff 0%, #c0c0c0 100%);
      color: #000; border-color:transparent;
      box-shadow: 0 0 20px rgba(255,255,255,0.15), 0 4px 15px rgba(0,0,0,0.5);
    }
    .btn-primary:hover { box-shadow:0 0 30px rgba(255,255,255,0.25); background:linear-gradient(135deg,#fff 0%,#ddd 100%); }
    .btn-full { width:100%; grid-column:1/-1; }

    .info-strip {
      display:flex;
      border:1px solid var(--border); border-radius:12px;
      overflow:hidden; margin-top:0.5rem;
    }
    .info-cell {
      flex:1; padding:0.8rem;
      display:flex; flex-direction:column; gap:0.2rem;
      border-right:1px solid var(--border);
    }
    .info-cell:last-child { border-right:none; }
    .info-label { font-family:'Space Mono',monospace; font-size:0.6rem; color:var(--text-muted); letter-spacing:0.1em; text-transform:uppercase; }
    .info-val { font-size:0.95rem; font-weight:700; }
    .info-val.green { color:var(--accent); }

    .success-wrapper { padding:1rem 0; }
    .success-icon { font-size:3rem; color:var(--accent); margin-bottom:1rem; }
    .success-title { font-size:1.4rem; font-weight:700; letter-spacing:0.1em; margin-bottom:1.5rem; }
    .success-card {
      background:rgba(255,255,255,0.05); border:1px solid var(--border);
      border-radius:12px; padding:1.2rem; margin-bottom:1.5rem;
    }

    .page-header { font-size:1.3rem; font-weight:700; letter-spacing:0.1em; margin-bottom:1.2rem; }

    .content-card {
      background:var(--card); border:1px solid var(--border);
      border-radius:14px; padding:1.4rem; margin-bottom:1rem;
      text-align:left; backdrop-filter:blur(20px);
    }
    .content-card h3 { font-size:1rem; font-weight:700; color:var(--accent); margin-bottom:0.8rem; text-transform:uppercase; letter-spacing:0.1em; }
    .content-card p, .content-card li { font-family:'Space Mono',monospace; font-size:0.72rem; color:var(--text-muted); line-height:1.8; }
    .content-card ul { padding-left:1.2rem; }
    .content-card li { margin-bottom:0.3rem; }

    .app-list { display:flex; gap:0.6rem; flex-wrap:wrap; margin-top:0.8rem; }
    .app-tag { padding:0.3rem 0.7rem; border:1px solid var(--accent); border-radius:6px; color:var(--accent); font-family:'Space Mono',monospace; font-size:0.65rem; }

    .step { display:flex; gap:0.8rem; align-items:flex-start; margin-bottom:0.8rem; }
    .step-num { width:22px; height:22px; border-radius:50%; background:var(--accent); color:#000; font-size:0.7rem; font-weight:700; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    .step-text { font-family:'Space Mono',monospace; font-size:0.72rem; color:var(--text-muted); line-height:1.7; }

    .sub-card { background:var(--card); border:1px solid rgba(0,255,136,0.3); border-radius:14px; padding:1.2rem; margin-bottom:1rem; text-align:left; }
    .sub-card-title { font-size:0.9rem; font-weight:700; color:var(--accent); margin-bottom:0.6rem; letter-spacing:0.1em; }
    .sub-detail { font-family:'Space Mono',monospace; font-size:0.68rem; color:var(--text-muted); margin:0.3rem 0; }

    .modal {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.92); backdrop-filter:blur(14px);
      display:none; align-items:flex-end; justify-content:center;
      z-index:500;
    }
    .modal.active { display:flex; }

    .modal-sheet {
      background: rgba(12,12,12,0.98);
      border:1px solid var(--border);
      border-radius:24px 24px 0 0;
      padding:2rem 1.5rem 3rem;
      width:100%; max-width:480px;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp { from { transform:translateY(100%); } to { transform:translateY(0); } }

    .modal-handle { width:36px; height:4px; background:rgba(255,255,255,0.2); border-radius:2px; margin:0 auto 1.5rem; }
    .modal-title { font-size:1.2rem; font-weight:700; letter-spacing:0.1em; margin-bottom:1.5rem; }

    .plan-card {
      background:rgba(255,255,255,0.03); border:1px solid var(--border);
      border-radius:12px; padding:1.1rem 1.2rem; margin-bottom:0.75rem;
      cursor:pointer; transition:all 0.2s;
      display:flex; align-items:center; justify-content:space-between;
    }
    .plan-card:hover { border-color:rgba(255,255,255,0.25); background:rgba(255,255,255,0.06); }
    .plan-card:active { transform:scale(0.98); }
    .plan-card.best { border-color:rgba(0,255,136,0.4); background:rgba(0,255,136,0.04); }
    .plan-name { font-size:1rem; font-weight:700; margin-bottom:0.2rem; }
    .plan-desc { font-family:'Space Mono',monospace; font-size:0.62rem; color:var(--text-muted); }
    .plan-price { font-size:1.3rem; font-weight:700; color:var(--accent); }
    .plan-badge { font-family:'Space Mono',monospace; font-size:0.6rem; background:var(--accent); color:#000; padding:0.15rem 0.5rem; border-radius:4px; margin-left:0.5rem; }

    .modal-close-btn { width:100%; margin-top:0.5rem; background:none; border:1px solid var(--border); color:var(--text-muted); font-family:'Rajdhani',sans-serif; font-size:0.85rem; letter-spacing:0.1em; padding:0.8rem; border-radius:10px; cursor:pointer; }

    /* ‚îÄ‚îÄ –ö–û–ú–ü–ê–ö–¢–ù–´–ô –î–ò–°–ö–õ–ï–ô–ú–ï–† ‚îÄ‚îÄ */
    .disclaimer-modal {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.88); backdrop-filter:blur(14px);
      display:none; align-items:flex-end; justify-content:center;
      z-index:600; padding:0;
    }
    .disclaimer-modal.active { display:flex; }

    .disclaimer-sheet {
      background: rgba(12,12,12,0.99);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:24px 24px 0 0;
      padding:2rem 1.5rem 3rem;
      width:100%; max-width:480px;
      animation: slideUp 0.3s ease;
    }

    .disclaimer-sheet .modal-handle { width:36px; height:4px; background:rgba(255,255,255,0.15); border-radius:2px; margin:0 auto 1.5rem; }

    .disclaimer-sheet .modal-title {
      font-size:1.1rem; font-weight:700; letter-spacing:0.1em;
      margin-bottom:1.4rem; color:rgba(255,200,80,0.9);
    }

    .disclaimer-row {
      display:flex; align-items:center; gap:0.85rem;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.09);
      border-radius:12px;
      padding:1rem 1.1rem;
      margin-bottom:1.4rem;
    }

    .disclaimer-row input[type=checkbox] {
      width:18px; height:18px;
      flex-shrink:0;
      accent-color:var(--accent);
      cursor:pointer;
    }

    .disclaimer-row label {
      font-family:'Space Mono',monospace;
      font-size:0.68rem;
      color:rgba(255,255,255,0.65);
      line-height:1.6;
      cursor:pointer;
    }

    .disclaimer-link {
      color:var(--accent);
      text-decoration:underline;
      text-underline-offset:3px;
      cursor:pointer;
    }

    .disclaimer-agree-btn {
      width:100%;
      background:linear-gradient(135deg,#fff 0%,#c0c0c0 100%);
      color:#000; border:none;
      padding:1rem; border-radius:10px;
      font-family:'Rajdhani',sans-serif;
      font-size:0.95rem; font-weight:700;
      letter-spacing:0.12em; cursor:pointer;
      opacity:0.35; transition:all 0.2s;
      pointer-events:none;
    }
    .disclaimer-agree-btn.enabled {
      opacity:1;
      pointer-events:auto;
      box-shadow:0 0 20px rgba(255,255,255,0.15);
    }
    .disclaimer-agree-btn.enabled:active { transform:scale(0.98); }

    /* ‚îÄ‚îÄ –°–¢–†–ê–ù–ò–¶–ê –¢–ï–ö–°–¢–ê –î–ò–°–ö–õ–ï–ô–ú–ï–†–ê ‚îÄ‚îÄ */
    .disclaimer-text-modal {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.96); backdrop-filter:blur(10px);
      display:none; align-items:flex-end; justify-content:center;
      z-index:700; padding:0;
    }
    .disclaimer-text-modal.active { display:flex; }

    .disclaimer-text-sheet {
      background:rgba(10,10,10,0.99);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:24px 24px 0 0;
      padding:2rem 1.5rem 3rem;
      width:100%; max-width:480px;
      max-height:80vh; overflow-y:auto;
      animation:slideUp 0.3s ease;
    }
    .disclaimer-text-sheet::-webkit-scrollbar { width:3px; }
    .disclaimer-text-sheet::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.1); border-radius:2px; }

    .disclaimer-text-sheet .modal-handle { width:36px; height:4px; background:rgba(255,255,255,0.15); border-radius:2px; margin:0 auto 1.5rem; }
    .disclaimer-text-sheet h3 { font-size:0.85rem; font-weight:700; color:rgba(255,180,60,0.9); letter-spacing:0.12em; text-transform:uppercase; margin-bottom:1.2rem; }

    .disclaimer-body {
      font-family:'Space Mono',monospace;
      font-size:0.63rem;
      color:rgba(255,255,255,0.5);
      line-height:1.9;
      text-align:left;
    }
    .disclaimer-body p { margin-bottom:0.9rem; }
    .disclaimer-body .warn { color:rgba(255,100,100,0.7); }

    .bottom-nav {
      position:fixed;
      bottom: max(env(safe-area-inset-bottom), 1rem);
      left:50%; transform:translateX(-50%);
      background:rgba(12,12,12,0.95); padding:0.6rem;
      border-radius:30px; border:1px solid rgba(255,255,255,0.08);
      display:flex; gap:0.3rem;
      box-shadow:0 10px 40px rgba(0,0,0,0.9);
      z-index:100; max-width:95vw; overflow-x:auto;
      scrollbar-width:none; backdrop-filter:blur(30px);
    }
    .bottom-nav::-webkit-scrollbar { display:none; }

    .nav-btn { background:none; border:none; color:var(--text-muted); font-family:'Space Mono',monospace; font-size:0.58rem; cursor:pointer; padding:0.55rem 0.9rem; border-radius:20px; transition:all 0.2s; display:flex; flex-direction:column; align-items:center; gap:0.25rem; min-width:52px; }
    .nav-btn span { font-size:1.1rem; line-height:1; }
    .nav-btn.active { background:rgba(255,255,255,0.08); color:var(--text); }

    .footer { position:fixed; bottom:max(env(safe-area-inset-bottom),1rem); right:1.5rem; color:rgba(255,255,255,0.18); font-family:'Space Mono',monospace; font-size:0.55rem; z-index:10; }
    .footer span { color:var(--accent); opacity:0.5; }

    @media (max-width:480px) {
      body { padding:0 1rem 6rem; }
      .logo-container { margin:7rem 0 1.2rem; }
      .container { overflow-y:auto; }
    }
  </style>
</head>
<body>
  <canvas id="bg-canvas"></canvas>
  <canvas id="prismLetter"></canvas>

  <div class="logo-container">
    <div class="logo" id="logoText">SPECTER VPN</div>
    <div class="logo-rule"></div>
    <div class="subtitle">–£–ª—å—Ç—Ä–∞ —Å–∫–æ—Ä–æ—Å—Ç—å &nbsp;¬∑&nbsp; Zero Logs &nbsp;¬∑&nbsp; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π LTE</div>
  </div>

  <div class="container">
    <div id="pages">

      <!-- –£–°–ü–ï–• -->
      <div id="page-success" class="page">
        <div class="success-wrapper">
          <div class="success-icon">‚úî</div>
          <h2 class="success-title">–¢–∞—Ä–∏—Ñ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</h2>
          <div class="success-card">
            <div id="success-plan" style="font-size:1rem;margin-bottom:0.4rem;">–¢–∞—Ä–∏—Ñ: ‚Äî</div>
            <div id="success-price" style="font-size:1.2rem;font-weight:700;color:var(--accent);margin-bottom:0.4rem;">‚Äî</div>
            <div id="success-date" style="color:var(--text-muted);font-size:0.85rem;">–î–∞—Ç–∞: ‚Äî</div>
          </div>
          <button id="copyVlessSuccess" class="btn btn-primary btn-full" style="margin-bottom:0.8rem;">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –í–°–ï –ö–õ–Æ–ß–ò</button>
          <p style="color:var(--text-muted);font-size:0.75rem;margin-bottom:1rem;font-family:'Space Mono',monospace;">Happ ¬∑ v2rayNG ¬∑ Hiddify ¬∑ Nekobox</p>
          <button class="btn btn-full" onclick="showPage('page-main')">‚Üê –ù–ê –ì–õ–ê–í–ù–£–Æ</button>
        </div>
      </div>

      <!-- –ì–õ–ê–í–ù–ê–Ø -->
      <div id="page-main" class="page active">
        <div class="user-card">
          <div class="avatar-wrap">
            <div class="avatar" id="avatar-main">üë§</div>
            <div class="avatar-ring"></div>
          </div>
          <div class="user-info">
            <div id="name-main" class="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="status-main" class="status error">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏</div>
          </div>
        </div>
        <div class="buttons">
          <button id="buyBtn" class="btn btn-primary">–ö–£–ü–ò–¢–¨</button>
          <button id="settingsBtn" class="btn">–ù–ê–°–¢–†–û–ô–ö–ê</button>
        </div>
        <div class="info-strip">
          <div class="info-cell">
            <span class="info-label">–ü—Ä–æ—Ç–æ–∫–æ–ª</span>
            <span class="info-val">VLESS</span>
          </div>
          <div class="info-cell">
            <span class="info-label">–õ–æ–≥–∏</span>
            <span class="info-val green">ZERO</span>
          </div>
          <div class="info-cell">
            <span class="info-label">–°—Ç–∞—Ç—É—Å</span>
            <span class="info-val" id="conn-status">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- –ü–†–û–§–ò–õ–¨ -->
      <div id="page-profile" class="page">
        <div class="page-header">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="user-card">
          <div class="avatar-wrap">
            <div class="avatar" id="avatar-profile">üë§</div>
            <div class="avatar-ring"></div>
          </div>
          <div class="user-info">
            <div id="name-profile" class="user-name">–ì–æ—Å—Ç—å</div>
            <div id="status-profile" class="status error">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏</div>
          </div>
        </div>
        <div id="sub-card-profile" class="sub-card" style="display:none;">
          <div class="sub-card-title">–ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</div>
          <div id="prof-plan" class="sub-detail">–¢–∞—Ä–∏—Ñ: ‚Äî</div>
          <div id="prof-price" class="sub-detail">–°—Ç–æ–∏–º–æ—Å—Ç—å: ‚Äî</div>
          <div id="prof-date" class="sub-detail">–î–∞—Ç–∞: ‚Äî</div>
        </div>
        <div class="buttons">
          <button id="myKeysBtn" class="btn btn-primary">–ú–û–ò –ö–õ–Æ–ß–ò</button>
          <button class="btn" onclick="showPage('page-main')">–ì–õ–ê–í–ù–ê–Ø</button>
        </div>
      </div>

      <!-- –ú–û–ò –ö–õ–Æ–ß–ò -->
      <div id="page-keys" class="page">
        <div class="page-header">–ú–æ–∏ –∫–ª—é—á–∏</div>
        <div id="keys-sub-card" class="sub-card" style="display:none;">
          <div class="sub-card-title">–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞</div>
          <div id="keys-plan" class="sub-detail">–¢–∞—Ä–∏—Ñ: ‚Äî</div>
          <div id="keys-price" class="sub-detail">–°—Ç–æ–∏–º–æ—Å—Ç—å: ‚Äî</div>
          <div id="keys-date" class="sub-detail">–î–∞—Ç–∞: ‚Äî</div>
        </div>
        <button id="copyVlessProfile" class="btn btn-primary btn-full" style="margin-bottom:1rem;display:none;">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –í–°–ï –ö–õ–Æ–ß–ò</button>
        <div id="no-keys-msg" style="color:var(--text-muted);font-family:'Space Mono',monospace;font-size:0.7rem;padding:1.5rem 0;">–ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏</div>
        <button class="btn btn-full" onclick="showPage('page-profile')" style="margin-top:0.5rem;">‚Üê –ü–†–û–§–ò–õ–¨</button>
      </div>

      <!-- –ù–ê–°–¢–†–û–ô–ö–ê -->
      <div id="page-settings" class="page">
        <div class="page-header">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</div>
        <div class="content-card">
          <h3>–®–∞–≥ 1 ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
          <p style="margin-bottom:0.8rem;">–î–ª—è —Ä–∞–±–æ—Ç—ã –∫–ª—é—á–µ–π –Ω—É–∂–Ω–æ –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:</p>
          <div class="app-list">
            <span class="app-tag">Happ</span>
            <span class="app-tag">v2rayNG</span>
            <span class="app-tag">Hiddify</span>
            <span class="app-tag">Nekobox</span>
            <span class="app-tag">v2rayN</span>
          </div>
        </div>
        <div class="content-card">
          <h3>–®–∞–≥ 2 ‚Äî –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
          <div class="step"><div class="step-num">1</div><div class="step-text">–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª ¬´–ú–æ–∏ –∫–ª—é—á–∏¬ª –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–ª—é—á–∏¬ª</div></div>
          <div class="step"><div class="step-num">2</div><div class="step-text">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Happ, v2rayNG –∏ —Ç.–¥.)</div></div>
          <div class="step"><div class="step-num">3</div><div class="step-text">–ù–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä¬ª –∏–ª–∏ –∑–Ω–∞—á–æ–∫ ¬´+¬ª</div></div>
          <div class="step"><div class="step-num">4</div><div class="step-text">–í—ã–±–µ—Ä–∏—Ç–µ ¬´–ò–º–ø–æ—Ä—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞¬ª ‚Äî –∫–ª—é—á–∏ –¥–æ–±–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div></div>
          <div class="step"><div class="step-num">5</div><div class="step-text">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ì–æ—Ç–æ–≤–æ ‚Äî –≤—ã –∑–∞—â–∏—â–µ–Ω—ã!</div></div>
        </div>
        <div class="content-card">
          <h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
          <p>–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø–∏—à–∏—Ç–µ –≤ Telegram. –ü–æ–º–æ–≥–∞–µ–º 24/7.</p>
        </div>
        <button class="btn btn-full" onclick="showPage('page-main')" style="margin-top:0.5rem;">‚Üê –ì–õ–ê–í–ù–ê–Ø</button>
      </div>

      <!-- –ò–ù–§–û -->
      <div id="page-info" class="page">
        <div class="page-header">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
        <div class="content-card">
          <h3>–û —Å–µ—Ä–≤–∏—Å–µ</h3>
          <ul>
            <li>–ü—Ä–æ—Ç–æ–∫–æ–ª: VLESS (xray-core)</li>
            <li>–¢—Ä–∞—Ñ–∏–∫: –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</li>
            <li>10 / 15 / 20+ —Å—Ç—Ä–∞–Ω –ø–æ —Ç–∞—Ä–∏—Ñ—É</li>
            <li>–õ–æ–≥–∏: –Ω–µ –≤–µ–¥—É—Ç—Å—è</li>
            <li>–ê–∫—Ç–∏–≤–∞—Ü–∏—è: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è</li>
            <li>LTE: –≤ —Ç–∞—Ä–∏—Ñ–∞—Ö 15 –∏ 20+</li>
          </ul>
        </div>
        <button class="btn btn-full" onclick="showPage('page-main')">‚Üê –ì–õ–ê–í–ù–ê–Ø</button>
      </div>

    </div>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –¢–ê–†–ò–§–û–í -->
  <div id="tariffModal" class="modal">
    <div class="modal-sheet">
      <div class="modal-handle"></div>
      <div class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</div>
      <div class="plan-card" onclick="openDisclaimer('forever_10')">
        <div><div class="plan-name">10 —Å—Ç—Ä–∞–Ω</div><div class="plan-desc">–ë–∞–∑–æ–≤—ã–π ¬∑ –ë–µ–∑ LTE ¬∑ –ù–∞–≤—Å–µ–≥–¥–∞</div></div>
        <div class="plan-price">500 ‚ÇΩ</div>
      </div>
      <div class="plan-card" onclick="openDisclaimer('forever_15')">
        <div><div class="plan-name">15 —Å—Ç—Ä–∞–Ω</div><div class="plan-desc">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π ¬∑ LTE ¬∑ –ù–∞–≤—Å–µ–≥–¥–∞</div></div>
        <div class="plan-price">900 ‚ÇΩ</div>
      </div>
      <div class="plan-card best" onclick="openDisclaimer('forever_20')">
        <div><div class="plan-name">20+ —Å—Ç—Ä–∞–Ω <span class="plan-badge">TOP</span></div><div class="plan-desc">–ú–∞–∫—Å–∏–º—É–º ¬∑ –ú–Ω–æ–≥–æ LTE –ù–∞–≤—Å–µ–≥–¥–∞</div></div>
        <div class="plan-price">1800 ‚ÇΩ</div>
      </div>
      <button class="modal-close-btn" onclick="closeModal()">–û–¢–ú–ï–ù–ê</button>
    </div>
  </div>

  <!-- –ö–û–ú–ü–ê–ö–¢–ù–´–ô –î–ò–°–ö–õ–ï–ô–ú–ï–† -->
  <div id="disclaimerModal" class="disclaimer-modal">
    <div class="disclaimer-sheet">
      <div class="modal-handle"></div>
      <div class="modal-title">‚ö† –ü–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π</div>
      <div class="disclaimer-row">
        <input type="checkbox" id="disclaimerCheck" onchange="toggleAgreeBtn()">
        <label for="disclaimerCheck">
          –Ø –æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å
          <span class="disclaimer-link" onclick="openDisclaimerText()">–æ—Ç–∫–∞–∑–æ–º –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</span>
          –∏ –ø—Ä–∏–Ω–∏–º–∞—é –µ–≥–æ —É—Å–ª–æ–≤–∏—è. –ò—Å–ø–æ–ª—å–∑—É—é VPN —Ç–æ–ª—å–∫–æ –≤ –∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö.
        </label>
      </div>
      <button class="disclaimer-agree-btn" id="disclaimerAgreeBtn" onclick="confirmPlan()">–ü–û–î–¢–í–ï–†–ñ–î–ê–Æ –ò –ü–†–û–î–û–õ–ñ–ê–Æ</button>
    </div>
  </div>

  <!-- –ü–û–õ–ù–´–ô –¢–ï–ö–°–¢ –î–ò–°–ö–õ–ï–ô–ú–ï–†–ê (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö) -->
  <div id="disclaimerTextModal" class="disclaimer-text-modal">
    <div class="disclaimer-text-sheet">
      <div class="modal-handle"></div>
      <h3>‚ö† –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</h3>
      <div class="disclaimer-body">
        <p>–ê–≤—Ç–æ—Ä –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–æ–º, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –∏–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö VPN-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π. –≠—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –æ–±–∑–æ—Ä –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
        <p>–î–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–ª–∞–º–æ–π VPN. –í–µ—Å—å –º–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π –∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä–∞–∂–¥–∞–Ω —Ç–µ—Ö —Å—Ç—Ä–∞–Ω, –≥–¥–µ —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ª–µ–≥–∞–ª—å–Ω–∞, –∫–∞–∫ –º–∏–Ω–∏–º—É–º ‚Äî –≤ –Ω–∞—É—á–Ω—ã—Ö —Ü–µ–ª—è—Ö. –ï—Å–ª–∏ –≤–∞–º —Ç–∞–∫–æ–µ —á–∏—Ç–∞—Ç—å –Ω–µ–ª—å–∑—è ‚Äî –∑–∞–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.</p>
        <p>–ê–≤—Ç–æ—Ä –Ω–µ –∏–º–µ–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π, –Ω–µ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–µ –ø–æ–æ—â—Ä—è–µ—Ç –∏ –Ω–µ –æ–ø—Ä–∞–≤–¥—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN –∏ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º –Ω–∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö.</p>
        <p>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ª—é–±–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö VPN-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ª–µ–∂–∏—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ —Å–∞–º–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.</p>
        <p>–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –∞–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü –∏ –Ω–µ –ø–æ–æ—â—Ä—è–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–ø—Ä–∞–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN.</p>
        <p>–ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Ç–æ—á–Ω–æ—Å—Ç—å, –ø–æ–ª–Ω–æ—Ç—É –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω—ã. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª.</p>
        <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–æ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω—ã. VPN ‚Äî —Ç–æ–ª—å–∫–æ –≤ –∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö: –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏ –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —É–¥–∞–ª—ë–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ.</p>
        <p>–ü—Ä–æ–µ–∫—Ç –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π, –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π. –í—Å—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏ –∞–≤—Ç–æ—Ä—É –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç.</p>
        <p class="warn">–°–æ–≤–µ—Ç: –∑–∞–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ VPN –∏ –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–∞–º–∏, —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º–∏ –≤–∞—à–∏–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º.</p>
      </div>
      <button class="btn btn-full" style="margin-top:1.5rem;" onclick="closeDisclaimerText()">‚Üê –ù–ê–ó–ê–î</button>
    </div>
  </div>

  <nav class="bottom-nav">
    <button class="nav-btn active" data-page="page-main"><span>‚¨õ</span>–ì–ª–∞–≤–Ω–∞—è</button>
    <button class="nav-btn" data-page="buy"><span>‚óà</span>–ö—É–ø–∏—Ç—å</button>
    <button class="nav-btn" data-page="page-info"><span>‚óé</span>–ò–Ω—Ñ–æ</button>
    <button class="nav-btn" data-page="page-settings"><span>‚äï</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <button class="nav-btn" data-page="page-profile"><span>‚óâ</span>–ü—Ä–æ—Ñ–∏–ª—å</button>
  </nav>

  <div class="footer">Made by <span>BERSERK</span> ¬© 2026</div>

  <script>
    const API_BASE = "http://127.0.0.1:8000";

    const PLANS = {
      forever_10: { name:'10 —Å—Ç—Ä–∞–Ω (–±–µ–∑ LTE)', price:500, keysUrl:'https://storage.yandexcloud.net/tariff10/–æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ.txt' },
      forever_15: { name:'15 —Å—Ç—Ä–∞–Ω (LTE)', price:900, keysUrl:'https://storage.yandexcloud.net/tariff15/–æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ.txt' },
      forever_20: { name:'20+ —Å—Ç—Ä–∞–Ω (–ú–Ω–æ–≥–æ LTE)', price:1800, keysUrl:'https://storage.yandexcloud.net/tariff20/–æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ.txt' }
    };

    let userId = 'user_' + Math.random().toString(36).substring(2, 11);
    let currentUserPlan = null;
    let pendingPlanKey   = null;
    let activationDate   = null;

    // Telegram
    if (window.Telegram?.WebApp) {
      const tg = Telegram.WebApp;
      tg.ready(); tg.expand(); tg.enableClosingConfirmation();
      tg.MainButton.setText("–ó–∞–∫—Ä—ã—Ç—å"); tg.MainButton.show();
      tg.MainButton.onClick(() => tg.close());
      const user = tg.initDataUnsafe?.user;
      if (user) {
        userId = String(user.id);
        const name = [user.first_name, user.last_name].filter(Boolean).join(' ');
        document.getElementById('name-main').textContent    = name;
        document.getElementById('name-profile').textContent = name;
        if (user.photo_url) {
          ['avatar-main','avatar-profile'].forEach(id => {
            const el = document.getElementById(id);
            el.textContent = '';
            el.style.backgroundImage = `url(${user.photo_url})`;
            el.style.backgroundSize  = 'cover';
          });
        }
      }
    }

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const el = document.getElementById(id);
      if (el) el.classList.add('active');
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      const navBtn = document.querySelector(`.nav-btn[data-page="${id}"]`);
      if (navBtn) navBtn.classList.add('active');
    }

    document.querySelectorAll('.bottom-nav .nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const page = btn.dataset.page;
        if (page === 'buy') { openTariffModal(); return; }
        showPage(page);
        if (page === 'page-keys') loadMyKeysPage();
      });
    });

    async function loadUserStatus() {
      try {
        const res = await fetch(`${API_BASE}/status/${userId}`);
        if (!res.ok) throw new Error();
        const data = await res.json();
        const active = data.has_key;
        setStatus(active);
        currentUserPlan = data.plan || null;
        activationDate  = data.activated_at || null;
        if (active && currentUserPlan) updateProfileCard();
      } catch(e) {
        setStatus(false);
      }
    }

    function setStatus(active) {
      const text = active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏';
      const cls  = active ? 'status' : 'status error';
      ['status-main','status-profile'].forEach(id => {
        const el = document.getElementById(id);
        el.textContent = text; el.className = cls;
      });
      document.getElementById('conn-status').textContent = active ? 'OK' : '‚Äî';
      const buyBtn = document.getElementById('buyBtn');
      buyBtn.textContent = active ? '–ê–ö–¢–ò–í–ï–ù' : '–ö–£–ü–ò–¢–¨';
      buyBtn.disabled    = active;
    }

    function updateProfileCard() {
      const plan = PLANS[currentUserPlan];
      if (!plan) return;
      document.getElementById('sub-card-profile').style.display = 'block';
      document.getElementById('prof-plan').textContent  = `–¢–∞—Ä–∏—Ñ: ${plan.name}`;
      document.getElementById('prof-price').textContent = `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${plan.price} ‚ÇΩ`;
      document.getElementById('prof-date').textContent  = `–î–∞—Ç–∞: ${activationDate ? new Date(activationDate).toLocaleString('ru-RU') : new Date().toLocaleString('ru-RU')}`;
    }

    function openTariffModal() {
      if (document.getElementById('buyBtn').disabled) { alert('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞'); return; }
      document.getElementById('tariffModal').classList.add('active');
    }

    function closeModal() { document.getElementById('tariffModal').classList.remove('active'); }

    function openDisclaimer(planKey) {
      closeModal();
      pendingPlanKey = planKey;
      document.getElementById('disclaimerCheck').checked = false;
      document.getElementById('disclaimerAgreeBtn').classList.remove('enabled');
      document.getElementById('disclaimerModal').classList.add('active');
    }

    function openDisclaimerText() {
      document.getElementById('disclaimerTextModal').classList.add('active');
    }

    function closeDisclaimerText() {
      document.getElementById('disclaimerTextModal').classList.remove('active');
    }

    function toggleAgreeBtn() {
      document.getElementById('disclaimerAgreeBtn').classList.toggle('enabled', document.getElementById('disclaimerCheck').checked);
    }

    async function confirmPlan() {
      if (!document.getElementById('disclaimerCheck').checked) return;
      document.getElementById('disclaimerModal').classList.remove('active');
      await selectPlan(pendingPlanKey);
      pendingPlanKey = null;
    }

    async function selectPlan(planKey) {
      try {
        const res = await fetch(`${API_BASE}/buy`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user_id:userId, plan:planKey}) });
        if (!res.ok) throw new Error();
      } catch(e) { console.warn('–¢–µ—Å—Ç–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞'); }

      const plan = PLANS[planKey];
      currentUserPlan = planKey;
      activationDate  = new Date().toISOString();

      document.getElementById('success-plan').textContent  = `–¢–∞—Ä–∏—Ñ: ${plan.name}`;
      document.getElementById('success-price').textContent = `${plan.price} ‚ÇΩ`;
      document.getElementById('success-date').textContent  = `–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}`;

      setStatus(true);
      updateProfileCard();
      showPage('page-success');
    }

    async function copyVlessAll() {
      if (!currentUserPlan) { alert('–°–Ω–∞—á–∞–ª–∞ –∫—É–ø–∏—Ç–µ —Ç–∞—Ä–∏—Ñ'); return; }
      try {
        const res = await fetch(`${API_BASE}/my_keys/${userId}`);
        if (!res.ok) throw new Error('no_keys');
        const data = await res.json();
        const url = data.keys_url || PLANS[currentUserPlan]?.keysUrl;
        if (!url) throw new Error('no_url');
        await navigator.clipboard.writeText(url);
        alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–ª—é—á–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –í—Å—Ç–∞–≤—å—Ç–µ –µ—ë –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
      } catch (e) {
        const plan = PLANS[currentUserPlan];
        if (plan?.keysUrl) {
          await navigator.clipboard.writeText(plan.keysUrl);
          alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–ª—é—á–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –í—Å—Ç–∞–≤—å—Ç–µ –µ—ë –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
        } else {
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–ª—é—á–∏.');
        }
      }
    }

    function loadMyKeysPage() {
      const plan = PLANS[currentUserPlan];
      const subCard = document.getElementById('keys-sub-card');
      const copyBtn = document.getElementById('copyVlessProfile');
      const noKeys  = document.getElementById('no-keys-msg');
      if (!currentUserPlan || !plan) {
        subCard.style.display = 'none'; copyBtn.style.display = 'none'; noKeys.style.display = 'block'; return;
      }
      subCard.style.display = 'block'; copyBtn.style.display = 'block'; noKeys.style.display = 'none';
      document.getElementById('keys-plan').textContent  = `–¢–∞—Ä–∏—Ñ: ${plan.name}`;
      document.getElementById('keys-price').textContent = `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${plan.price} ‚ÇΩ`;
      document.getElementById('keys-date').textContent  = `–î–∞—Ç–∞: ${activationDate ? new Date(activationDate).toLocaleString('ru-RU') : '‚Äî'}`;
    }

    document.getElementById('buyBtn').onclick      = openTariffModal;
    document.getElementById('settingsBtn').onclick = () => showPage('page-settings');
    document.getElementById('myKeysBtn').onclick   = () => { loadMyKeysPage(); showPage('page-keys'); };
    document.getElementById('copyVlessSuccess')?.addEventListener('click', copyVlessAll);
    document.getElementById('copyVlessProfile')?.addEventListener('click', copyVlessAll);
    document.getElementById('tariffModal').addEventListener('click', e => { if (e.target === document.getElementById('tariffModal')) closeModal(); });

    loadUserStatus();
    showPage('page-main');

    // BG PARTICLES
    const bgCanvas = document.getElementById('bg-canvas');
    const bgCtx    = bgCanvas.getContext('2d');
    function resizeBg() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
    resizeBg();
    window.addEventListener('resize', () => { resizeBg(); resizeLetter(); });
    const particles = Array.from({length:70}, () => ({ x:Math.random()*bgCanvas.width, y:Math.random()*bgCanvas.height, radius:Math.random()*1.2+0.2, speedX:(Math.random()-0.5)*0.15, speedY:(Math.random()-0.5)*0.15, alpha:Math.random()*0.25+0.05 }));
    function animateBg() {
      bgCtx.fillStyle = 'rgba(0,0,0,0.1)';
      bgCtx.fillRect(0,0,bgCanvas.width,bgCanvas.height);
      particles.forEach(p => {
        p.x+=p.speedX; p.y+=p.speedY;
        if(p.x<0||p.x>bgCanvas.width) p.speedX*=-1;
        if(p.y<0||p.y>bgCanvas.height) p.speedY*=-1;
        bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.radius,0,Math.PI*2);
        bgCtx.fillStyle=`rgba(255,255,255,${p.alpha})`; bgCtx.fill();
      });
      requestAnimationFrame(animateBg);
    }
    animateBg();

    // PRISM RAY
    const letterCanvas = document.getElementById('prismLetter');
    const letterCtx    = letterCanvas.getContext('2d');
    function resizeLetter() { letterCanvas.width=window.innerWidth; letterCanvas.height=window.innerHeight; }
    resizeLetter();
    let time = 0;

    function wlToColor(wl, alpha=1) {
      let r=0,g=0,b=0;
      if(wl>=380&&wl<440){r=(440-wl)/60;b=1;}
      else if(wl>=440&&wl<490){g=(wl-440)/50;b=1;}
      else if(wl>=490&&wl<510){g=1;b=(510-wl)/20;}
      else if(wl>=510&&wl<580){r=(wl-510)/70;g=1;}
      else if(wl>=580&&wl<645){r=1;g=(645-wl)/65;}
      else if(wl>=645&&wl<=780){r=1;}
      if(wl<420) alpha*=(wl-380)/40;
      if(wl>700) alpha*=(780-wl)/80;
      return `rgba(${Math.round(r*255)},${Math.round(g*255)},${Math.round(b*255)},${alpha})`;
    }

    function animatePrism() {
      letterCtx.clearRect(0,0,letterCanvas.width,letterCanvas.height);
      time+=16;
      const logo = document.getElementById('logoText');
      if(!logo) return requestAnimationFrame(animatePrism);
      const rect = logo.getBoundingClientRect();
      const hitX = rect.left + rect.width * 0.41;
      const hitY = rect.top  + rect.height * 0.15;
      const ANGLE_RAD = 33 * Math.PI / 180;
      const startX = -80;
      const startY = hitY - Math.tan(ANGLE_RAD) * (hitX - startX);
      const cycle = 8000;
      const t = (time % cycle) / cycle;
      const progress = t < 0.5 ? t / 0.5 : 1;
      const pulse = 0.7 + 0.3 * Math.sin(time * 0.0009);
      const curX = startX + (hitX - startX) * Math.min(progress, 1);
      const curY = startY + (hitY - startY) * Math.min(progress, 1);
      const rayGrad = letterCtx.createLinearGradient(startX,startY,curX,curY);
      rayGrad.addColorStop(0,'rgba(255,255,255,0)');
      rayGrad.addColorStop(0.35,'rgba(255,255,255,0.2)');
      rayGrad.addColorStop(0.8,'rgba(255,255,255,0.9)');
      rayGrad.addColorStop(1,'rgba(255,255,255,1)');
      letterCtx.save();
      letterCtx.lineWidth=3; letterCtx.lineCap='round';
      letterCtx.shadowBlur=24; letterCtx.shadowColor='rgba(255,255,255,0.8)';
      letterCtx.strokeStyle=rayGrad;
      letterCtx.beginPath(); letterCtx.moveTo(startX,startY); letterCtx.lineTo(curX,curY); letterCtx.stroke();
      letterCtx.restore();
      if(progress>=1) {
        const flashR = 8 + 5*Math.sin(time*0.005)*pulse;
        const fi1 = letterCtx.createRadialGradient(hitX,hitY,0,hitX,hitY,flashR);
        fi1.addColorStop(0,`rgba(255,255,255,${0.95*pulse})`);
        fi1.addColorStop(0.5,`rgba(200,220,255,${0.5*pulse})`);
        fi1.addColorStop(1,'rgba(255,255,255,0)');
        letterCtx.save(); letterCtx.fillStyle=fi1; letterCtx.beginPath(); letterCtx.arc(hitX,hitY,flashR,0,Math.PI*2); letterCtx.fill(); letterCtx.restore();
        const fo = letterCtx.createRadialGradient(hitX,hitY,0,hitX,hitY,flashR*5);
        fo.addColorStop(0,`rgba(180,200,255,${0.3*pulse})`);
        fo.addColorStop(0.4,`rgba(255,255,255,${0.08*pulse})`);
        fo.addColorStop(1,'rgba(255,255,255,0)');
        letterCtx.save(); letterCtx.fillStyle=fo; letterCtx.beginPath(); letterCtx.arc(hitX,hitY,flashR*5,0,Math.PI*2); letterCtx.fill(); letterCtx.restore();
        const rayCount=7, fanStart=ANGLE_RAD+(8*Math.PI/180), fanSpread=42*Math.PI/180;
        const rayLength=Math.min(letterCanvas.width,letterCanvas.height)*0.6;
        for(let i=0;i<rayCount;i++) {
          const fi=i/(rayCount-1), wl=380+400*fi, ang=fanStart+fanSpread*fi;
          const ex=hitX+Math.cos(ang)*rayLength, ey=hitY+Math.sin(ang)*rayLength;
          const rg=letterCtx.createLinearGradient(hitX,hitY,ex,ey);
          rg.addColorStop(0,wlToColor(wl,1*pulse)); rg.addColorStop(0.45,wlToColor(wl,0.6*pulse)); rg.addColorStop(0.8,wlToColor(wl,0.2*pulse)); rg.addColorStop(1,wlToColor(wl,0));
          letterCtx.save(); letterCtx.globalAlpha=pulse; letterCtx.lineWidth=3.5-fi*0.8; letterCtx.lineCap='round'; letterCtx.shadowBlur=22+fi*14; letterCtx.shadowColor=wlToColor(wl,1); letterCtx.strokeStyle=rg; letterCtx.beginPath(); letterCtx.moveTo(hitX,hitY); letterCtx.lineTo(ex,ey); letterCtx.stroke(); letterCtx.restore();
          const rg2=letterCtx.createLinearGradient(hitX,hitY,ex,ey);
          rg2.addColorStop(0,wlToColor(wl,0.7*pulse)); rg2.addColorStop(0.5,wlToColor(wl,0.25*pulse)); rg2.addColorStop(1,wlToColor(wl,0));
          letterCtx.save(); letterCtx.globalAlpha=pulse*0.7; letterCtx.lineWidth=1.2; letterCtx.shadowBlur=8; letterCtx.shadowColor=wlToColor(wl,1); letterCtx.strokeStyle=rg2; letterCtx.beginPath(); letterCtx.moveTo(hitX,hitY); letterCtx.lineTo(ex,ey); letterCtx.stroke(); letterCtx.restore();
        }
        for(let i=0;i<18;i++) {
          const fi=(i%rayCount)/(rayCount-1), wl=380+400*fi, ang=fanStart+fanSpread*fi;
          const dist=((time*0.05+i*48)%(rayLength*0.8))+rayLength*0.05;
          const sx=hitX+Math.cos(ang)*dist, sy=hitY+Math.sin(ang)*dist;
          const sa=0.9*pulse*Math.max(0,Math.sin(time*0.012+i*0.8));
          letterCtx.save(); letterCtx.globalAlpha=sa; letterCtx.shadowBlur=14; letterCtx.shadowColor=wlToColor(wl,1); letterCtx.fillStyle=wlToColor(wl,1); letterCtx.beginPath(); letterCtx.arc(sx,sy,1.8+Math.sin(time*0.02+i)*0.9,0,Math.PI*2); letterCtx.fill(); letterCtx.restore();
        }
        for(let i=0;i<rayCount;i++) {
          const fi=i/(rayCount-1), wl=380+400*fi, ang=fanStart+fanSpread*fi;
          const bx=hitX+Math.cos(ang)*rayLength*0.3, by=hitY+Math.sin(ang)*rayLength*0.3;
          letterCtx.save(); letterCtx.globalAlpha=0.4*pulse; letterCtx.shadowBlur=8; letterCtx.shadowColor=wlToColor(wl,1); letterCtx.fillStyle=wlToColor(wl,0.8); letterCtx.beginPath(); letterCtx.arc(bx,by,2.5,0,Math.PI*2); letterCtx.fill(); letterCtx.restore();
        }
      }
      requestAnimationFrame(animatePrism);
    }
    animatePrism();
  </script>
</body>
</html>
